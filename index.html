<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro e Login Simulado com Firebase</title>
<style>
body { font-family: Arial; margin: 20px; }
input, select, button { margin: 5px 0; padding: 5px; }
#dashboard { display: none; margin-top: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 5px; }
th { background-color: #f2f2f2; }
</style>
</head>
<body>

<h1>Cadastro e Login Simulado</h1>

<h2>Cadastro de Usuários</h2>
<input type="text" id="name" placeholder="Nome">
<input type="text" id="login" placeholder="Login">
<input type="password" id="password" placeholder="Senha">
<select id="tipo">
  <option value="">Tipo</option>
  <option value="usuario">Usuário</option>
  <option value="gestor">Gestor</option>
</select>
<button onclick="addUser()">Cadastrar</button>

<h2>Login</h2>
<input type="text" id="loginInput" placeholder="Login">
<input type="password" id="passwordInput" placeholder="Senha">
<select id="tipoInput">
  <option value="">Tipo</option>
  <option value="usuario">Usuário</option>
  <option value="gestor">Gestor</option>
</select>
<button onclick="login()">Entrar</button>

<div id="dashboard">
  <h2>Bem-vindo <span id="userNameDisplay"></span></h2>
  <p id="userRoleDisplay"></p>

  <h3>Meses</h3>
  <input type="number" id="monthYear" placeholder="Ano">
  <input type="number" id="monthMonth" placeholder="Mês">
  <label>Ativo <input type="checkbox" id="monthActive"></label>
  <button onclick="addMonth()">Adicionar Mês</button>

  <table id="monthsTable">
    <thead>
      <tr><th>Ano</th><th>Mês</th><th>Ativo</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>

<script>
  // ----- CONFIGURAÇÃO DO FIREBASE -----
  const firebaseConfig = {
    apiKey: "AIzaSyDB41mLHYDSS0lyJ_kqBtjTsh0hd3Mn92A",
    authDomain: "fireapp-escalabc.firebaseapp.com",
    databaseURL: "https://fireapp-escalabc.firebaseio.com",
    projectId: "fireapp-escalabc",
    storageBucket: "fireapp-escalabc.appspot.com",
    messagingSenderId: "76641115162",
    appId: "1:76641115162:web:4d78f078651361f24ec3a"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let loggedUser = null;

  // ----- CADASTRO DE USUÁRIOS -----
  function addUser() {
    const name = document.getElementById("name").value;
    const login = document.getElementById("login").value;
    const password = document.getElementById("password").value;
    const tipo = document.getElementById("tipo").value;

    if (!name || !login || !password || !tipo) {
      alert("Preencha todos os campos");
      return;
    }

    db.ref("usuarios").push({ name, login, password, tipo });
    alert("Usuário cadastrado!");
    document.getElementById("name").value = "";
    document.getElementById("login").value = "";
    document.getElementById("password").value = "";
    document.getElementById("tipo").value = "";
  }

  // ----- LOGIN SIMULADO -----
  function login() {
    const loginInput = document.getElementById("loginInput").value;
    const passwordInput = document.getElementById("passwordInput").value;
    const tipoInput = document.getElementById("tipoInput").value;

    db.ref("usuarios").once("value").then(snapshot => {
      let found = null;
      snapshot.forEach(snap => {
        const u = snap.val();
        if (u.login === loginInput && u.password === passwordInput && u.tipo === tipoInput) {
          found = u;
        }
      });

      if (found) {
        loggedUser = found;
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("userNameDisplay").innerText = loggedUser.name;
        document.getElementById("userRoleDisplay").innerText = "Tipo: " + loggedUser.tipo;
        startRealtime();
      } else {
        alert("Login ou senha incorretos!");
        loggedUser = null;
        document.getElementById("dashboard").style.display = "none";
      }
    });
  }

  // ----- ADICIONAR MESES -----
  function addMonth() {
    if (!loggedUser) return alert("Faça login primeiro!");
    const year = document.getElementById("monthYear").value;
    const month = document.getElementById("monthMonth").value;
    const active = document.getElementById("monthActive").checked;

    if (!year || !month) return alert("Preencha ano e mês");

    db.ref("meses").push({ year, month, active, owner: loggedUser.login });
    document.getElementById("monthYear").value = "";
    document.getElementById("monthMonth").value = "";
    document.getElementById("monthActive").checked = false;
  }

  // ----- RENDERIZAÇÃO EM TEMPO REAL -----
  function startRealtime() {
    db.ref("meses").on("value", snapshot => {
      const tbody = document.querySelector("#monthsTable tbody");
      tbody.innerHTML = "";
      snapshot.forEach(snap => {
        const m = snap.val();
        if (loggedUser && (loggedUser.tipo === "gestor" || m.owner === loggedUser.login)) {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${m.year}</td><td>${m.month}</td><td>${m.active ? "Sim" : "Não"}</td>`;
          tbody.appendChild(tr);
        }
      });
    });
  }
</script>

</body>
</html>
