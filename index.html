<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Escala Simples</title>
</head>
<body>

<h2>Entrar</h2>
<input id="name" placeholder="Seu nome">
<input id="code" placeholder="Código" type="password">
<button id="loginBtn">Entrar</button>

<div id="app" style="display:none;">
  <h2 id="userLabel"></h2>
  <div id="calendar"></div>
</div>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const supabaseUrl = 'https://exhfpeeslhjpvfmbonyz.supabase.co'
const supabaseKey = 'SUA_CHAVE_ANON'
const supabase = createClient(supabaseUrl, supabaseKey)

const loginBtn = document.getElementById('loginBtn')
loginBtn.addEventListener('click', async () => {
  const name = document.getElementById('name').value.trim()
  const code = document.getElementById('code').value.trim()

  // Busca usuário na tabela simples "users"
  const { data, error } = await supabase
    .from('users')
    .select('*')
    .eq('name', name)
    .single()

  if (error || !data) return alert('Usuário não encontrado')
  if (data.password !== code) return alert('Código incorreto')

  // Login bem-sucedido
  document.getElementById('loginBtn').style.display = 'none'
  document.getElementById('name').style.display = 'none'
  document.getElementById('code').style.display = 'none'

  document.getElementById('app').style.display = 'block'
  document.getElementById('userLabel').innerText = `Olá, ${name}`

  loadCalendar(name)
})

async function loadCalendar(name) {
  // Busca apenas os registros do usuário
  const { data: days } = await supabase
    .from('days')
    .select('*')
    .eq('user_name', name)  // assumindo que você tenha essa coluna
  const { data: turns } = await supabase
    .from('turns')
    .select('*')
    .in('day_id', days.map(d => d.id))

  const container = document.getElementById('calendar')
  container.innerHTML = ''

  days.forEach(day => {
    const dayTurns = turns.filter(t => t.day_id === day.id)
    const card = document.createElement('div')
    card.innerHTML = `<h3>${day.date} (${day.weekday})</h3>`
    dayTurns.forEach(t => {
      const section = document.createElement('div')
      section.innerHTML = `<b>${t.type.toUpperCase()}</b> - ${t.slot1 || 'Disponível'}`
      card.appendChild(section)
    })
    container.appendChild(card)
  })
}
</script>

</body>
</html>
