<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Simulação de Login com Firebase</title>
<style>
body { font-family: Arial; margin: 20px; }
input, select, button { margin: 5px 0; padding: 5px; }
#dashboard { display: none; margin-top: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 5px; }
th { background-color: #f2f2f2; }
</style>
</head>
<body>

<h2>Cadastro de Usuários</h2>
<input type="text" id="name" placeholder="Nome">
<input type="text" id="login" placeholder="Login">
<input type="password" id="password" placeholder="Senha">
<select id="tipo">
  <option value="">Tipo</option>
  <option value="usuario">Usuário</option>
  <option value="gestor">Gestor</option>
</select>
<button onclick="addUser()">Cadastrar</button>

<h2>Login Simulado</h2>
<input type="text" id="loginInput" placeholder="Login">
<input type="password" id="passwordInput" placeholder="Senha">
<select id="tipoInput">
  <option value="">Tipo</option>
  <option value="usuario">Usuário</option>
  <option value="gestor">Gestor</option>
</select>
<button onclick="login()">Entrar</button>

<div id="dashboard">
  <h2>Bem-vindo <span id="userNameDisplay"></span></h2>
  <p id="userRoleDisplay"></p>

  <h3>Meses</h3>
  <input type="number" id="monthYear" placeholder="Ano">
  <input type="number" id="monthMonth" placeholder="Mês">
  <label>Ativo <input type="checkbox" id="monthActive"></label>
  <button onclick="addMonth()">Adicionar Mês</button>

  <table id="monthsTable">
    <thead>
      <tr><th>Ano</th><th>Mês</th><th>Ativo</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
<script>
// ----- CONFIGURAÇÃO DO FIREBASE -----
// Substitua pelos dados do seu projeto Firebase
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  databaseURL: "https://SEU_PROJETO.firebaseio.com",
  projectId: "SEU_PROJETO",
  storageBucket: "SEU_PROJETO.appspot.com",
  messagingSenderId: "SEU_ID",
  appId: "SEU_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let loggedUser = null;

// ----- USUÁRIOS -----
function addUser() {
  const name = document.getElementById("name").value;
  const login = document.getElementById("login").value;
  const password = document.getElementById("password").value;
  const tipo = document.getElementById("tipo").value;
  if (!name || !login || !password || !tipo) return alert("Preencha todos os campos");

  // Salva no Firebase
  db.ref("usuarios").push({ name, login, password, tipo });
  alert("Usuário cadastrado!");
  document.getElementById("name").value = "";
  document.getElementById("login").value = "";
  document.getElementById("password").value = "";
  document.getElementById("tipo").value = "";
}

// ----- LOGIN SIMULADO -----
function login() {
  const loginInput = document.getElementById("loginInput").value;
  const passwordInput = document.getElementById("passwordInput").value;
  const tipoInput = document.getElementById("tipoInput").value;

  db.ref("usuarios").once("value").then(snapshot => {
    let found = null;
    snapshot.forEach(snap => {
      const u = snap.val();
      if (u.login === loginInput && u.password === passwordInput && u.tipo === tipoInput) {
        found = u;
      }
    });

    if (found) {
      loggedUser = found;
      document.getElementById("dashboard").style.display = "block";
      document.getElementById("userNameDisplay").innerText = loggedUser.name;
      document.getElementById("userRoleDisplay").innerText = "Tipo: " + loggedUser.tipo;
      renderMonths();
    } else {
      alert("Login ou senha incorretos!");
      loggedUser = null;
      document.getElementById("dashboard").style.display = "none";
    }
  });
}

// ----- MESES -----
function addMonth() {
  if (!loggedUser) return alert("Faça login primeiro!");
  const year = document.getElementById("monthYear").value;
  const month = document.getElementById("monthMonth").value;
  const active = document.getElementById("monthActive").checked;
  if (!year || !month) return alert("Preencha ano e mês");

  db.ref("meses").push({ year, month, active, owner: loggedUser.login });
  renderMonths();
  document.getElementById("monthYear").value = "";
  document.getElementById("monthMonth").value = "";
  document.getElementById("monthActive").checked = false;
}

// ----- RENDERIZAÇÃO -----
function renderMonths() {
  const tbody = document.querySelector("#monthsTable tbody");
  tbody.innerHTML = "";
  db.ref("meses").once("value").then(snapshot => {
    snapshot.forEach(snap => {
      const m = snap.val();
      if (loggedUser.tipo === "gestor" || m.owner === loggedUser.login) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${m.year}</td><td>${m.month}</td><td>${m.active ? "Sim" : "Não"}</td>`;
        tbody.appendChild(tr);
      }
    });
  });
}
</script>
</body>
</html>
